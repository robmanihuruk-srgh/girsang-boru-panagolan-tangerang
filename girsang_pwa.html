<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèõÔ∏è Girsang Boru Panagolan Tangerang</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:system-ui,-apple-system,sans-serif;background:#f8f9fa;min-height:100vh;}
        .header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:20px;text-align:center;position:sticky;top:0;z-index:100;}
        .header h1{font-size:clamp(1.5rem,5vw,2.5rem);margin:0;}
        .navbar{background:#fff;padding:15px;box-shadow:0 2px 10px rgba(0,0,0,0.1);position:sticky;top:80px;z-index:99;}
        .nav-links{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;}
        .nav-links a{color:#495057;text-decoration:none;padding:12px 20px;border-radius:25px;font-weight:500;transition:all 0.3s;}
        .nav-links a.active,.nav-links a:hover{background:#667eea;color:white;}
        .container{max-width:1200px;margin:20px auto;padding:20px;}
        .section{background:white;border-radius:20px;padding:30px;margin:20px 0;box-shadow:0 10px 30px rgba(0,0,0,0.1);display:none;}
        .section.active{display:block;}
        .section-header{padding:20px;background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:white;border-radius:15px;margin:-30px -30px 30px -30px;}
        .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;}
        .stat-card{background:#f8f9fa;padding:25px;border-radius:15px;text-align:center;transition:all 0.3s;}
        .stat-card:hover{transform:translateY(-5px);}
        .stat-number{font-size:2.5rem;font-weight:bold;color:#667eea;}
        .stat-label{color:#666;}
        .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;}
        input,select{padding:15px;border:2px solid #e9ecef;border-radius:12px;font-size:16px;width:100%;transition:all 0.3s;}
        input:focus,select:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,0.1);}
        .btn{padding:15px 30px;border:none;border-radius:12px;cursor:pointer;font-size:16px;font-weight:600;transition:all 0.3s;margin:10px 5px 0 0;}
        .btn-primary{background:#28a745;color:white;}
        .btn-primary:hover{background:#218838;}
        .btn-danger{background:#dc3545;color:white;}
        .btn-danger:hover{background:#c82333;}
        table{width:100%;border-collapse:collapse;margin:20px 0;border-radius:12px;overflow:hidden;box-shadow:0 5px 20px rgba(0,0,0,0.1);}
        th{background:#667eea;color:white;padding:15px;font-weight:500;}
        td{padding:15px;border-bottom:1px solid #f0f0f0;}
        tr:hover{background:#f9f9f9;}
        .status-badge{padding:8px 16px;border-radius:25px;font-size:14px;font-weight:600;display:inline-block;}
        .aktif{background:#d4edda;color:#155724;}
        .nonaktif{background:#f8d7da;color:#721c24;}
        .login-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:1000;}
        .login-box{background:white;padding:40px;border-radius:20px;width:90%;max-width:400px;text-align:center;box-shadow:0 20px 40px rgba(0,0,0,0.3);}
        .status{display:inline-block;padding:5px 12px;border-radius:20px;font-size:12px;margin-left:10px;}
        .online{background:#28a745;color:white;}
        .offline{background:#dc3545;color:white;}
        .success-msg{background:#d4edda;color:#155724;padding:15px;border-radius:12px;margin:15px 0;display:none;}
        @media(max-width:768px){.form-grid{grid-template-columns:1fr;}}
    </style>
</head>
<body>
    <!-- Login -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <h1 style="color:#667eea;margin-bottom:20px;">üèõÔ∏è Girsang Boru Panagolan</h1>
            <p style="color:#666;margin-bottom:30px;">Sistem Manajemen Tangerang</p>
            <input type="text" id="username" placeholder="Username" value="admin" style="margin-bottom:15px;width:100%;padding:15px;">
            <input type="password" id="password" placeholder="Password" value="admin123" style="margin-bottom:20px;width:100%;padding:15px;">
            <button onclick="login()" class="btn btn-primary" style="width:100%;">üöÄ MASUK SISTEM</button>
            <p style="margin-top:20px;color:#666;font-size:14px;">admin / admin123</p>
        </div>
    </div>

    <!-- App -->
    <div id="app" style="display:none;">
        <div class="header">
            <h1>üèõÔ∏è Kumpulan Girsang Boru Panagolan Tangerang</h1>
            <p>Real-time Management System <span id="status" class="status online">üü¢ Online</span></p>
            <button onclick="logout()" class="btn btn-danger" style="position:absolute;top:25px;right:25px;padding:10px 20px;border-radius:50%;width:60px;height:60px;font-size:20px;">√ó</button>
        </div>

        <nav class="navbar">
            <div class="nav-links">
                <a onclick="showSection('dashboard')" class="active">üìä Dashboard</a>
                <a onclick="showSection('members')">üë• Anggota</a>
                <a onclick="showSection('attendance')">üìã Absensi</a>
                <a onclick="showSection('finance')">üí∞ Keuangan</a>
            </div>
        </nav>

        <div class="container">
            <!-- DASHBOARD -->
            <section id="dashboard" class="section active">
                <div class="section-header">
                    <h2>üìä Dashboard Overview</h2>
                </div>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="activeMembers">0</div>
                        <div class="stat-label">Anggota Aktif</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="todayAtt">0</div>
                        <div class="stat-label">Hadir Hari Ini</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="saldoKas">Rp 0</div>
                        <div class="stat-label">Saldo Kas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalMem">0</div>
                        <div class="stat-label">Total Anggota</div>
                    </div>
                </div>
            </section>

            <!-- MEMBERS -->
            <section id="members" class="section">
                <div class="section-header">
                    <h2>üë• Manajemen Keanggotaan</h2>
                </div>
                <div class="form-grid">
                    <input id="newName" placeholder="Nama Lengkap *">
                    <input id="newAddr" placeholder="Alamat *">
                    <input id="newPhone" placeholder="No. HP">
                    <input id="newEmail" placeholder="Email">
                    <input id="newPos" placeholder="Jabatan">
                    <button onclick="addMember()" class="btn btn-primary">‚ûï Tambah Anggota</button>
                </div>
                <div id="memberMsg" class="success-msg"></div>
                <table>
                    <thead>
                        <tr><th>ID</th><th>Nama</th><th>Alamat</th><th>HP</th><th>Status</th><th>Aksi</th></tr>
                    </thead>
                    <tbody id="memberTable"></tbody>
                </table>
            </section>

            <!-- ATTENDANCE -->
            <section id="attendance" class="section">
                <div class="section-header">
                    <h2>üìã Daftar Hadir</h2>
                </div>
                <div class="form-grid">
                    <select id="attMember">
                        <option value="">Pilih Anggota</option>
                    </select>
                    <input type="date" id="attDate">
                    <select id="attStatus">
                        <option value="hadir">‚úÖ Hadir</option>
                        <option value="alfa">‚ùå Alfa</option>
                        <option value="izin">üìÑ Izin</option>
                        <option value="sakit">üè• Sakit</option>
                    </select>
                    <button onclick="addAttendance()" class="btn btn-primary">‚úÖ Absen</button>
                </div>
                <h3 style="margin:30px 0 20px 0;">üìä Hadir Hari Ini</h3>
                <table>
                    <thead><tr><th>Nama</th><th>Status</th><th>Waktu</th></tr></thead>
                    <tbody id="attTable"></tbody>
                </table>
            </section>

            <!-- FINANCE -->
            <section id="finance" class="section">
                <div class="section-header">
                    <h2>üí∞ Manajemen Keuangan</h2>
                </div>
                <div class="form-grid">
                    <select id="finMember">
                        <option value="">[Umum]</option>
                    </select>
                    <input id="finDesc" placeholder="Deskripsi *">
                    <input type="number" id="finAmount" placeholder="Jumlah *" step="0.01">
                    <input type="date" id="finDate">
                    <select id="finType">
                        <option value="pemasukan">üí∞ Pemasukan</option>
                        <option value="pengeluaran">üì§ Pengeluaran</option>
                    </select>
                    <button onclick="addFinance()" class="btn btn-primary">üí∏ Simpan</button>
                </div>
                <div id="finMsg" class="success-msg"></div>
                <h3 style="margin:30px 0 20px 0;">üìà Transaksi Terbaru</h3>
                <table>
                    <thead><tr><th>Deskripsi</th><th>Jumlah</th><th>Tanggal</th><th>Jenis</th></tr></thead>
                    <tbody id="finTable"></tbody>
                </table>
            </section>
        </div>
    </div>

    <!-- Firebase SDK v9 Compat (Work di Vercel/GitHub) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // ‚úÖ FIREBASE CONFIG ANDA ASLI
        const firebaseConfig = {
            apiKey: "AIzaSyCqF5VG2T03yaHOAq8dPhtvgMYrbVq-DIs",
            authDomain: "girsangborupanagolantangerang.firebaseapp.com",
            databaseURL: "https://girsangborupanagolantangerang-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "girsangborupanagolantangerang",
            storageBucket: "girsangborupanagolantangerang.firebasestorage.app",
            messagingSenderId: "823404152768",
            appId: "1:823404152768:web:c743fa07b22455452b2a25",
            measurementId: "G-716P2TK99Y"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let members = [], attendance = [], finances = [];
        let currentUser = null;

        // Network status
        window.addEventListener('online', () => document.getElementById('status').innerHTML = 'üü¢ Online');
        window.addEventListener('offline', () => document.getElementById('status').innerHTML = 'üî¥ Offline');

        // Login
        function login() {
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            if(user === 'admin' && pass === 'admin123') {
                currentUser = 'admin';
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                loadData();
            } else {
                alert('Login salah!');
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginOverlay').style.display = 'flex';
            document.getElementById('app').style.display = 'none';
        }

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
        }

        // Real-time Firebase listeners
        function loadData() {
            // Members
            db.ref('members').on('value', (snapshot) => {
                const data = snapshot.val();
                members = data ? Object.values(data) : [];
                renderMembers();
                updateSelects();
                updateDashboard();
            });

            // Attendance
            db.ref('attendance').on('value', (snapshot) => {
                const data = snapshot.val();
                attendance = data ? Object.values(data) : [];
                renderAttendance();
                updateDashboard();
            });

            // Finance
            db.ref('finances').on('value', (snapshot) => {
                const data = snapshot.val();
                finances = data ? Object.values(data) : [];
                renderFinances();
                updateDashboard();
            });
        }

        function addMember() {
            const data = {
                id: firebase.database.ServerValue.TIMESTAMP,
                nama: document.getElementById('newName').value,
                alamat: document.getElementById('newAddr').value,
                phone: document.getElementById('newPhone').value,
                email: document.getElementById('newEmail').value,
                jabatan: document.getElementById('newPos').value,
                status: 'aktif',
                created: firebase.database.ServerValue.TIMESTAMP
            };
            
            if(!data.nama || !data.alamat) return alert('Lengkapi nama & alamat!');
            
            db.ref('members').push(data);
            showMsg('memberMsg', '‚úÖ Anggota ditambahkan!');
            clearMemberForm();
        }

        function addAttendance() {
            const memberId = document.getElementById('attMember').value;
            if(!memberId) return alert('Pilih anggota!');
            
            const data = {
                id: firebase.database.ServerValue.TIMESTAMP,
                memberId: memberId,
                date: document.getElementById('attDate').value,
                time: new Date().toLocaleTimeString('id-ID', {hour12: false}).slice(0,5),
                status: document.getElementById('attStatus').value,
                created: firebase.database.ServerValue.TIMESTAMP
            };
            
            db.ref('attendance').push(data);
        }

        function addFinance() {
            const data = {
                id: firebase.database.ServerValue.TIMESTAMP,
                memberId: document.getElementById('finMember').value || null,
                desc: document.getElementById('finDesc').value,
                amount: parseFloat(document.getElementById('finAmount').value),
                date: document.getElementById('finDate').value,
                type: document.getElementById('finType').value,
                created: firebase.database.ServerValue.TIMESTAMP
            };
            
            if(!data.desc || !data.amount) return alert('Lengkapi deskripsi & jumlah!');
            
            db.ref('finances').push(data);
            showMsg('finMsg', '‚úÖ Transaksi disimpan!');
            clearFinanceForm();
        }

        function renderMembers() {
            const tbody = document.getElementById('memberTable');
            tbody.innerHTML = '';
            members.slice(-20).forEach(member => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${member.id ? member.id.toString().slice(-6) : 'N/A'}</td>
                    <td><strong>${member.nama}</strong></td>
                    <td>${member.alamat?.slice(0,25) || '-'}${member.alamat?.length > 25 ? '...' : ''}</td>
                    <td>${member.phone || '-'}</td>
                    <td><span class="status-badge ${member.status}">${member.status}</span></td>
                    <td><button onclick="toggleMember('${member.id}')" class="btn btn-danger">Nonaktif</button></td>
                `;
            });
        }

        function renderAttendance() {
            const today = new Date().toISOString().split('T')[0];
            const todayAtt = attendance.filter(a => a.date === today);
            const tbody = document.getElementById('attTable');
            tbody.innerHTML = '';
            todayAtt.slice(-10).reverse().forEach(att => {
                const member = members.find(m => m.id == att.memberId);
                if(member) {
                    const row = tbody.insertRow();
                    row.innerHTML = `<td>${member.nama}</td><td>${att.status}</td><td>${att.time}</td>`;
                }
            });
        }

        function renderFinances() {
            const tbody = document.getElementById('finTable');
            tbody.innerHTML = '';
            finances.slice(0,10).reverse().forEach(fin => {
                const row = tbody.insertRow();
                const color = fin.type === 'pemasukan' ? '#28a745' : '#dc3545';
                row.innerHTML = `
                    <td>${fin.desc}</td>
                    <td style="color:${color};font-weight:bold">Rp ${Math.round(fin.amount).toLocaleString()}</td>
                    <td>${fin.date}</td>
                    <td>${fin.type}</td>
                `;
            });
        }

        function updateSelects() {
            const attSelect = document.getElementById('attMember');
            const finSelect = document.getElementById('finMember');
            
            attSelect.innerHTML = '<option value="">Pilih Anggota</option>';
            finSelect.innerHTML = '<option value="">[Umum]</option>';
            
            members.filter(m => m.status === 'aktif').forEach(m => {
                attSelect.innerHTML += `<option value="${m.id}">${m.nama}</option>`;
                finSelect.innerHTML += `<option value="${m.id}">${m.nama}</option>`;
            });
        }

        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];
            const active = members.filter(m => m.status === 'aktif').length;
            const todayAtt = attendance.filter(a => a.date === today).length;
            const total = members.length;
            const saldo = finances.reduce((sum, f) => 
                f.type === 'pemasukan' ? sum + (f.amount || 0) : sum - (f.amount || 0), 0);

            document.getElementById('activeMembers').textContent = active;
            document.getElementById('todayAtt').textContent = todayAtt;
            document.getElementById('saldoKas').textContent = 'Rp ' + Math.abs(saldo).toLocaleString();
            document.getElementById('totalMem').textContent = total;
        }

        function toggleMember(id) {
            const member = members.find(m => m.id === id);
            if(member) {
                db.ref(`members/${id}`).update({status: member.status === 'aktif' ? 'nonaktif' : 'aktif'});
            }
        }

        function clearMemberForm() {
            document.getElementById('newName').value = '';
            document.getElementById('newAddr').value = '';
            document.querySelectorAll('#members input').forEach(i => i.value = '');
        }

        function clearFinanceForm() {
            document.getElementById('finDesc').value = '';
            document.getElementById('finAmount').value = '';
        }

        function showMsg(id, msg) {
            const el = document.getElementById(id);
            el.textContent = msg;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 3000);
        }

        // Init dates
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('attDate').value = today;
            document.getElementById('finDate').value = today;
        });
    </script>
</body>
</html>
